<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.idle.campers.board.dao.BoardMapper">
	<select id="boardList" resultType="board">
		select *
		from (select a.*, rownum as rnum
             from   (select b.*, u.user_name
                     from tbl_board b, tbl_user u
                     where b.brd_writer = u.user_id
                     and b.brd_type = #{type}
	<if test="sch  == 'writer'">and u.user_name LIKE '%' || #{keyword} || '%'</if>
	<if test="sch  == 'title'">and b.BRD_TITLE LIKE '%' || #{keyword} || '%'</if>
	<if test="sch  == 'content'">and b.BRD_CONTENT LIKE '%' || #{keyword} || '%'</if>
	<if test="sch  == 'wdate'">AND b.BRD_DATE BETWEEN TO_DATE(#{keyword}, 'yyyy-MM-dd') - INTERVAL '1' DAY
								AND TO_DATE(#{keyword}, 'yyyy-MM-dd')</if>
					 order by b.brd_id desc
					) a
			
			)
	<![CDATA[
		where	rnum > (#{page} - 1) * 10
		and     rnum <= (#{page} * 10)
	]]>
	</select>
	
  <select id="boardSelect" parameterType="int">
  SELECT * FROM TBL_BOARD WHERE BRD_ID = #{brdId}
  
  </select>
  
  <select id="topInfoList" resultType="board">
	<![CDATA[
		select *
		from tbl_board
		where rownum <= 3
		and brd_type = 'inform'
		order by brd_id desc
		]]>
	</select>
  
  <update id="boardInquiry" parameterType="long">
  UPDATE TBL_BOARD SET BRD_READ = BRD_READ+1 WHERE BRD_ID=#{brdId}
  </update>
  
  <delete id="boardDelete" parameterType="int">
  DELETE FROM TBL_BOARD WHERE BRD_ID=#{brdId} 
  </delete>
  
  <update id="boardEdit" parameterType="com.idle.campers.board.dao.BoardVO">
  	UPDATE TBL_BOARD
  	SET   BRD_TITLE = #{brdTitle}
  		, BRD_CONTENT = #{brdContent}
  		, BRD_TYPE = #{brdType}
  		, BRD_IMAGE = #{brdImage}
  	WHERE BRD_ID = #{brdId} 
  	
  </update>
  
  
    <insert id="boardAdd" parameterType="com.idle.campers.board.dao.BoardVO">
  	INSERT INTO TBL_BOARD (BRD_ID, BRD_TITLE, BRD_WRITER, BRD_CONTENT,  BRD_TYPE, BRD_ADDR, brd_image)
  	VALUES (board_seq.nextval, #{brdTitle}, #{brdWriter}, #{brdContent}, #{brdType}, #{brdAddr}, #{brdImage})
  	</insert>
  	
  	
  
  	<!-- 좋아요 mybatis 영역 -->
  	<select id="likecheck"  resultType="int">
  		select count(*) from tbl_brd_like where brd_id = #{bid} and user_Id = #{id}
  	</select>
  	<select id="getTotalCnt" parameterType="String" resultType="int">
  		select count(1) 
		from tbl_board
		where brd_type = #{type}
	</select>
	
  	<!-- 게시글 추천 -->
  	<insert id="boarLikeUpdate" >
  		insert into tbl_brd_like values(#{bid},#{id})
  	</insert>
  	
  	<!-- 게시글 추천 취소 -->
  	<delete id="boarLikeDelete" >
  		delete from tbl_brd_like where brd_id = #{bid} and user_Id = #{id}
  	</delete>
  	
  	<!-- 게시글 추천수 -->
  	<select id="boardLikeCount">
  		select count(*) from tbl_brd_like where brd_id = #{bid}
  	</select>
	
	<!-- my 페이지 -->
	<!-- my 작성한 게시글 수 -->
  	<select id="myBoardCnt">
  		SELECT COUNT(*) board_cnt
  		FROM TBL_BOARD WHERE BRD_WRITER =#{id}
  	</select>
  	
  	<!-- my 작성한 게시글 리스트 최근 5개 -->
  	<select id="myBoardList">
  		SELECT * FROM TBL_BOARD WHERE BRD_WRITER = #{id} order by brd_id desc
  	</select>
</mapper>